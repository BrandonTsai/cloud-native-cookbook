
Regarding the fact that docker container has grown increasingly popular, developers and security teams should take actions to monitor and protect their applications from any potential risk. To reviewing the security state of the container images, the most common method is scanning all possible vulnerabilities inside the container images prior to deploying them to producgtion environment, and here is where [Trivy](https://github.com/aquasecurity/trivy) stand out.


Trivy is a comprehensive and easy-to-use tool for scanning the vulnerability for containers. It can be used to scan your local images, it has integrated with some popular image repositories, evenmore, it provides the operator which allow users to automatically update security report resources in response to workload and other changes on a Kubernetes cluster.

This article will first talk about how to set up Trivy and use it to scan the local container images, followed by talking about the integration with Harbor registry and showing how the Trivy Operator can help user secure their Kubernetes applications.


Scan Local Container Images
-----------------------

The installation if very easy, there is no pre-requisites such as installation of Databse, libraries, etc.

For Mac user, you can simply using homebrew for installation.

```bash
$ brew install aquasecurity/trivy/trivy
```

Once the installation is done, We can scan our local image in one command easily.


```
$ trivy image aquasec/trivy:latest
2022-07-09T01:58:24.886+1000	INFO	Need to update DB
2022-07-09T01:58:24.887+1000	INFO	DB Repository: ghcr.io/aquasecurity/trivy-db
2022-07-09T01:58:24.887+1000	INFO	Downloading DB...
32.96 MiB / 32.96 MiB [----------------------------------------------------------------------------------------------------------------------------------------------------------] 100.00% 4.46 MiB p/s 7.6s
2022-07-09T01:58:52.515+1000	INFO	Detected OS: alpine
2022-07-09T01:58:52.515+1000	INFO	This OS version is not on the EOL list: alpine 3.16
2022-07-09T01:58:52.516+1000	INFO	Detecting Alpine vulnerabilities...
2022-07-09T01:58:52.527+1000	INFO	Number of language-specific files: 1
2022-07-09T01:58:52.527+1000	INFO	Detecting gobinary vulnerabilities...

aquasec/trivy:latest (alpine 3.16.0)
====================================
Total: 6 (UNKNOWN: 0, LOW: 2, MEDIUM: 4, HIGH: 0, CRITICAL: 0)

+--------------+------------------+----------+-------------------+---------------+---------------------------------------+
|   LIBRARY    | VULNERABILITY ID | SEVERITY | INSTALLED VERSION | FIXED VERSION |                 TITLE                 |
+--------------+------------------+----------+-------------------+---------------+---------------------------------------+
| libcrypto1.1 | CVE-2022-2097    | LOW      | 1.1.1o-r0         | 1.1.1q-r0     | openssl: AES OCB fails                |
|              |                  |          |                   |               | to encrypt some bytes                 |
|              |                  |          |                   |               | -->avd.aquasec.com/nvd/cve-2022-2097  |
+--------------+------------------+----------+-------------------+---------------+---------------------------------------+
| libcurl      | CVE-2022-32205   | MEDIUM   | 7.83.1-r1         | 7.83.1-r2     | curl: Set-Cookie denial of service    |
|              |                  |          |                   |               | -->avd.aquasec.com/nvd/cve-2022-32205 |
+              +------------------+          +                   +               +---------------------------------------+
|              | CVE-2022-32206   |          |                   |               | curl: HTTP compression                |
|              |                  |          |                   |               | denial of service                     |
|              |                  |          |                   |               | -->avd.aquasec.com/nvd/cve-2022-32206 |
+              +------------------+          +                   +               +---------------------------------------+
|              | CVE-2022-32207   |          |                   |               | curl: Unpreserved file permissions    |
|              |                  |          |                   |               | -->avd.aquasec.com/nvd/cve-2022-32207 |
+              +------------------+          +                   +               +---------------------------------------+
|              | CVE-2022-32208   |          |                   |               | curl: FTP-KRB bad                     |
|              |                  |          |                   |               | message verification                  |
|              |                  |          |                   |               | -->avd.aquasec.com/nvd/cve-2022-32208 |
+--------------+------------------+----------+-------------------+---------------+---------------------------------------+
| libssl1.1    | CVE-2022-2097    | LOW      | 1.1.1o-r0         | 1.1.1q-r0     | openssl: AES OCB fails                |
|              |                  |          |                   |               | to encrypt some bytes                 |
|              |                  |          |                   |               | -->avd.aquasec.com/nvd/cve-2022-2097  |
+--------------+------------------+----------+-------------------+---------------+---------------------------------------+

usr/local/bin/trivy (gobinary)
==============================
Total: 2 (UNKNOWN: 1, LOW: 0, MEDIUM: 0, HIGH: 1, CRITICAL: 0)

+----------------------------------+---------------------+----------+--------------------------------------+-----------------------+----------------------------------------------+
|             LIBRARY              |  VULNERABILITY ID   | SEVERITY |          INSTALLED VERSION           |     FIXED VERSION     |                    TITLE                     |
+----------------------------------+---------------------+----------+--------------------------------------+-----------------------+----------------------------------------------+
| github.com/containerd/containerd | CVE-2022-23648      | HIGH     | v1.6.1-0.20220606171923-c1bcabb45419 | 1.4.13, 1.5.10, 1.6.1 | containerd: insecure                         |
|                                  |                     |          |                                      |                       | handling of image volumes                    |
|                                  |                     |          |                                      |                       | -->avd.aquasec.com/nvd/cve-2022-23648        |
+                                  +---------------------+----------+                                      +-----------------------+----------------------------------------------+
|                                  | GHSA-5ffw-gxpp-mxpf | UNKNOWN  |                                      | v1.5.13, v1.6.6       | Improper Neutralization of Special Elements  |
|                                  |                     |          |                                      |                       | used in an OS Command ('OS Command...        |
|                                  |                     |          |                                      |                       | -->github.com/advisories/GHSA-5ffw-gxpp-mxpf |
+----------------------------------+---------------------+----------+--------------------------------------+-----------------------+----------------------------------------------+

```

Integrate with Harbor
--------

- Harbor



Integrate with OpenShift
--------

Trivy Operator




Work with Trivy via Golang
------------------

Trivy does not have Restful API
They use RPC request.

But we still can work with Trivy via Golang

https://github.com/developer-guy/image-scanning-using-trivy-as-go-library


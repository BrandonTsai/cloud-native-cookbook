<html>
<head>
  <style>
  table, th, td {
    border: 1px solid black;
    border-collapse: collapse;
  }
  th, td {
    padding: 15px;
    text-align: left;
  }
  table#t01 {
    width: 100%;
    background-color: #f1f1c1;
  }
  h2 {
    margin-top: 35px;
  }
  h3, h4 {
    margin-top: 25px;
  }
  </style>
</head>
<body>
  
<h2>Prerequisites</h2>
<p>Download the lastest Helm package from <a href="https://github.com/splunk/splunk-connect-for-kubernetes">Splunk-connect-for-kubernetes</a>.</p>
<h2>Update values.yaml for logging</h2>
<p>The minimal value example:</p>
<pre class="codehilite"><code class="language-YAML">splunk:
  hec:
    host: &lt; splunk_host &gt;
    port: 8088
    token: &lt; splunk_hec_logging_token &gt;
    indexName: &lt; splunk_logging_indexname &gt;</code></pre>


<p><strong>Optional:</strong> Customize buffer setting</p>
<pre class="codehilite"><code class="language-YAML">buffer:
  &quot;@type&quot;: memory
  total_limit_size: 8000m
  chunk_limit_size: 8m
  chunk_limit_records: 10000000000
  flush_at_shutdown: true
  flush_interval: 3s
  flush_thread_count: 20
  flush_thread_interval: 0.1
  flush_thread_burst_interval: 0.01
  overflow_action: block
  retry_forever: true
  retry_wait: 30
  compress: gzip</code></pre>


<p><strong>Optional:</strong> Customize filter setting</p>
<pre class="codehilite"><code class="language-YAML">customFilters:
  SetNamespaceFilter:
    tag: &quot;**&quot;
    type: grep
    body: |
        &lt;exclude&gt;
                  key namespace
                  pattern /(kube-system)/
                &lt;/exclude&gt;
                &lt;exclude&gt;
                  key sourcetype
                  pattern /(fluentd:monitor-agent|kube:container:calico-node)/
                &lt;/exclude&gt;</code></pre>


<h2>Deplopy to Kubernetes Cluster</h2>
<p>You can deploy to kubernetes cluster via helm directly.
Or generate kubernetes yaml files via helm template command and then deploy via kubectl.</p>
<pre class="codehilite"><code class="language-bash">helm template --name-template=k8s --namespace splunk-connect --output-dir ${output_folder} splunk-kubernetes-logging/

kubectl apply -f ${output_folder}/splunk-kubernetes-logging/templates/</code></pre>


<h2>Verify on Splunk</h2>
<pre class="codehilite"><code>index=&quot;k8s_&lt;ENV&gt;_logging&quot;</code></pre>
</body>
</html>